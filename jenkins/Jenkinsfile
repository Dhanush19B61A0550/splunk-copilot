pipeline {
  agent any

  environment {
    TERRACE_COPILOT_HOME = "${WORKSPACE}\\terracecopilot"
  }

  stages {
    stage('Checkout Code') {
      steps {
        checkout scm  // Pulls the code from your Git repository
      }
    }

    stage('Install Terrace Copilot CLI') {
      steps {
        bat '''
          mkdir %TERRACE_COPILOT_HOME%
          curl -sSL https://terracecopilot.dev/install.sh | bash -s -- --install-dir %TERRACE_COPILOT_HOME%
          set PATH=%TERRACE_COPILOT_HOME%\\bin;%PATH%
        '''
      }
    }

    stage('Analyze Config Files') {
      steps {
        bat '''
          set PATH=%TERRACE_COPILOT_HOME%\\bin;%PATH%
          mkdir terrace-review-output

          terracecopilot review configs\\inputs.conf --output terrace-review-output\\inputs_review.txt || echo No suggestions. > terrace-review-output\\inputs_review.txt
          terracecopilot review configs\\outputs.conf --output terrace-review-output\\outputs_review.txt || echo No suggestions. > terrace-review-output\\outputs_review.txt

          echo Inputs.conf Suggestions:
          type terrace-review-output\\inputs_review.txt

          echo Outputs.conf Suggestions:
          type terrace-review-output\\outputs_review.txt
        '''
      }
    }
  }
}
